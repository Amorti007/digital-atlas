<!DOCTYPE html>
<html lang="tr" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dijital Atlas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../src/css/main.css">
</head>
<body>

    <nav class="navbar navbar-expand-lg py-3">
        <div class="container">
            <a class="navbar-brand" href="#" onclick="loadPage('world_map')">
                <i class="fas fa-globe-americas"></i> Dijital Atlas
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav align-items-center gap-3">
                    <li class="nav-item"><a class="nav-link" href="#" onclick="loadPage('world_map')">Ana Sayfa</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Hakkında</a></li>
                    
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">TR</a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#">Türkçe</a></li>
                            <li><a class="dropdown-item" href="#">English</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <button class="btn btn-link nav-link" onclick="toggleTheme()">
                            <i class="fas fa-moon" id="theme-icon"></i>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main id="app-content" class="container-fluid p-0">
        </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // --- Sayfa yükleme motoru (Single-Page App için) ---
        async function loadPage(pageName) {
            const contentDiv = document.getElementById('app-content');
            
            try {
                // Fetch ile HTML iskeletini çek
                const response = await fetch(`${pageName}.html`);
                if (!response.ok) throw new Error('Sayfa yüklenemedi');

                // Gelen metni HTML olarak al ve içeriğe bas
                const html = await response.text();
                contentDiv.innerHTML = html;

                // Eğer yüklenen sayfa harita ise, SVG haritayı da yükle
                if (pageName === 'world_map') {
                    loadSVGMap();
                }

            } catch (error) {
                // Hata durumunda kullanıcıyı bilgilendir
                contentDiv.innerHTML = `<div class="alert alert-danger m-5">Hata: ${error.message}. <br>Lütfen projeyi bir yerel sunucuda (localhost) çalıştırdığınızdan emin olun.</div>`;
            }
        }

        // --- SVG Yükleme ve Enjekte Etme ---
        async function loadSVGMap() {
            const placeholder = document.getElementById('svg-placeholder');
            
            try {
                // Public klasöründeki SVG dosyasını çek
                const response = await fetch('assets/world.svg'); 
                
                if (!response.ok) throw new Error('Harita dosyası bulunamadı');
                
                const svgText = await response.text();
                
                // Yükleme ikonunu sil, yerine SVG kodunu yapıştır
                placeholder.outerHTML = svgText;
                
                // SVG yüklendikten sonra ID ver ki CSS/JS bulabilsin
                const svgElement = document.querySelector('#map-container svg');
                if(svgElement) {
                    svgElement.id = "world-map-svg";
                    initMapInteractions(); // Etkileşimleri başlat
                }

            } catch (error) {
                placeholder.innerHTML = `<p class="text-danger">Harita yüklenirken hata oluştu: ${error.message}</p>`;
            }
        }

        // --- Harita Etkileşimleri (Zoom & Popover) ---
        let scale = 1;
        
        function initMapInteractions() {
            const mapSvg = document.getElementById('world-map-svg');
            
            // Popoverları Tanımla
            const paths = mapSvg.querySelectorAll('path');
            paths.forEach(path => {
                // Bootstrap Popover'ı her ülke için tanımla
                new bootstrap.Popover(path, {
                    trigger: 'click',   // Tıklama ile aç
                    container: 'body',  // Sayfanın üstünde göster
                    placement: 'top',   // Üstte göster
                    html: true,          // HTML içeriğe izin ver
                    // Şimdilik sadece SVG içindeki 'title' bilgisini göster
                    content: function() { return this.getAttribute('name') || 'Veri Yok'; }
                });
            });
        }

        // Haritayı Zoom In/Out Yap
        function zoomMap(factor) {
            const mapSvg = document.getElementById('world-map-svg');
            if(!mapSvg) return;
            scale *= factor;
            mapSvg.style.transform = `scale(${scale})`;
        }

        // Haritayı (Zoom) Sıfırla
        function resetMap() {
            const mapSvg = document.getElementById('world-map-svg');
            if(!mapSvg) return;
            scale = 1;
            mapSvg.style.transform = `scale(1)`;
        }

        // --- Tema yönetimi ---
        function toggleTheme() {
            const html = document.documentElement;
            const icon = document.getElementById('theme-icon');
            if (html.getAttribute('data-theme') === 'light') {
                html.setAttribute('data-theme', 'dark');
                icon.className = 'fas fa-sun';
            } else {
                html.setAttribute('data-theme', 'light');
                icon.className = 'fas fa-moon';
            }
        }

        // --- Sayfa açılınca Haritayı Yükle ---
        document.addEventListener("DOMContentLoaded", () => {
            loadPage('world_map');
        });

    </script>
</body>
</html>